#########################################################################################
#
# Starship Command disassembler
#
#########################################################################################

from collections import OrderedDict

from commands import *
from trace6502 import hook_subroutine
import acorn

config.indent_loops = False
config.set_label_references(False)
config.set_hex_dump(False)
config.set_bytes_as_ascii(False)
config.show_autogenerated_labels = False
config.show_cpu_state = False
config.show_char_literals = False
config.show_all_labels = False

load(0x0e00, "ORIGINAL_DISK/COMM2#.bin")

acorn.mos_labels()
acorn.hardware_bbc()

label_dict = {}
label_names_used = {}

substitute_labels = {
#    (0x0900, 0x0ab1): {
#        "keys":  "keycounter",
#        "score": "disallowedkeytab",
#        "read":  "keytranstab",
#        "temp1": "internalkeynum",
#        "temp2": "inkeynum",
#        "temp4": "keyrownum",
#        "temp5": "keycolumnnum",
#        "temp6": "numrowclashes",
#        "temp7": "numcolumnclashes",
#    },
#    (0x1a26, 0x1a3a): {
#        "write": "string",
#        "write + 1": "string + 1",
#    },
#    (0x2733, 0x2734): {
#        "birddata": "birdpixelx",
#    },
#    (0x277c, 0x293e): {
#        "read": "hiscoreaddr",
#        "read + 1": "hiscoreaddr + 1",
#    },
}


replacement_labels = {
#    0x901a: "keycounter",
}

global_skip = 1
line_break = "----------------------------------------------------------------------------------"

def mylabel(addr, name):
    global unused_count

    if name in label_names_used:
        # increase usage count
        label_names_used[name] += 1
        name += str(label_names_used[name])
    else:
        label_names_used[name] = 0

    label(addr, name)
    label_dict[addr] = name

def get_label(addr):
    return label_dict[addr]

def ldxy(addr):
    test_addr = memory[addr+1] + 256 * memory[addr+3]
    lab = get_label(test_addr)
    expr(addr + 1, "<" + lab)
    expr(addr + 3, ">" + lab)

def label_skip(addr):
    global global_skip
    mylabel(addr, "skip" + str(global_skip))
    global_skip = global_skip + 1

def comment_lined(addr, comm = None):
    if comm:
        formatted_comment(addr, line_break + "\n" + comm + "\n" + line_break)
    else:
        formatted_comment(addr, line_break)

def mylabel_with_comment(addr, lab, comm = None):
    comment_lined(addr, comm)
    mylabel(addr, lab)

def hex_block(addr, bytes_per_line, lines):
    hexadecimal(addr, bytes_per_line * lines)
    for y in range(0, lines):
        byte(addr, bytes_per_line, bytes_per_line)
        addr += bytes_per_line

def picture_sprite(addr, label, width, height):
    mylabel(addr, label)
    bytes_per_line = (width + 7) // 8
    byte(addr, height * bytes_per_line, bytes_per_line)

    picture_binary(addr, height * bytes_per_line)


def sound_block(addr, lab):
    mylabel(addr, lab)
    word(addr, 1)
    mylabel(addr + 2, lab + "_envelope")
    word(addr + 2, 1)
    mylabel(addr + 4, lab + "_pitch")
    word(addr + 4, 1)
    mylabel(addr + 6, lab + "_length")
    word(addr + 6, 1)

def my_label_maker(addr, context, suggestion):

    for pair in substitute_labels:
        if context in range(pair[0], pair[1]):
            dict = substitute_labels[pair]
            if suggestion in dict:
                return dict[suggestion]

    if context in replacement_labels:
        return replacement_labels[context]
    return suggestion

set_label_maker_hook(my_label_maker)

# Relocate code: move(dets, source, length)
# move(0x0e00, 0x1f00, 0x42b0)

# Zero page
mylabel(0x70, "screen_address_low")
mylabel(0x71, "screen_address_high")
mylabel(0x72, "output_pixels")
mylabel(0x73, "output_fraction")
mylabel(0x74, "segment_length")
mylabel(0x75, "temp8")
mylabel(0x76, "temp9")
mylabel(0x77, "temp10")
mylabel(0x78, "segment_angle")
mylabel(0x79, "screen_start_high")
mylabel(0x7a, "x_pixels")
mylabel(0x7b, "y_pixels")
mylabel(0x7c, "temp11")

#mylabel(0x0080, "relocateDestLow")
#mylabel(0x0081, "relocateDestHigh")
#mylabel(0x0082, "relocateSourceStartLow")
#mylabel(0x0083, "relocateSourceStartHigh")
#mylabel(0x0082, "relocateSourceEndLow")
#mylabel(0x0083, "relocateSourceEndHigh")

mylabel(0x80, "temp0Low")
mylabel(0x81, "temp0High")
mylabel(0x82, "temp1Low")
mylabel(0x83, "temp1High")
mylabel(0x82, "temp2Low")
mylabel(0x83, "temp2High")
mylabel(0x84, "temp3")
mylabel(0x85, "temp4")
mylabel(0x86, "temp5")
mylabel(0x87, "temp6")
mylabel(0x88, "temp7")

mylabel(0x2d65, "scoreByte0")
mylabel(0x2d66, "scoreByte1")
mylabel(0x2d67, "scoreByte2")
mylabel(0x2d6e, "scoreDigit1")
mylabel(0x2d6f, "scoreDigit2")
mylabel(0x2d70, "scoreDigit3")
mylabel(0x2d71, "scoreDigit4")
mylabel(0x2d72, "scoreDigit5")
mylabel(0x2d73, "scoreDigit6")
mylabel(0x2d68, "unused")
mylabel(0x0e78, "cosine_table")

mylabel(0x008e, "pageLow")
mylabel(0x008f, "pageHigh")

comment(0x47d4, "MODE 4:")
mylabel(0x4a00, "someData")         # TODO
mylabel(0x4693, "instructionsData")
mylabel(0x47f7, "printInstructionsLoop")
expr(0x47ee, "<instructionsData")
expr(0x47f2, ">instructionsData")
mylabel(0x47a2, "unused")
mylabel(0x47ce, "skip")
comment(0x3636, "Disable cursor editing")
comment(0x2e37, "tab into position, TAB(33,30):")
comment(0x2e46, "display the characters for the score")
mylabel_with_comment(0x2dd0, "addToScoreAndDisplay", "add to score (in binary coded decimal)")
mylabel(0x2e01, "displayScore")
comment(0x2e01, "calculate the characters to display the score, then display them")
mylabel(0x2e53, "foundNonZeroDigit")
mylabel(0x2e58, "displayScoreCharacter")

mylabel(0x2dc9, "unused")
mylabel(0x2e4a, "displayScoreLoop")
mylabel(0x2e5e, "doneScoreUpdate")
mylabel(0x2dfb, "scoreUpdateIsNonZero")
mylabel(0x2d63, "scoreUpdateLow")
mylabel(0x2d64, "scoreUpdateHigh")
expr(0x2e55, "'0'")
expr(0x2e57, "'0'")
mylabel(0x2d75, "scoresForThings")
mylabel(0x2db2, "skip")
comment(0x356a, "clear screen")

mylabel_with_comment(0x2008, "sound0Data", "[only 4 bytes, but should be eight bytes?]")
mylabel_with_comment(0x2210, "colour1IsWhiteString")
mylabel(0x2216, "colour1IsBlackString")
mylabel(0x221c, "colour0IsBlackString")
mylabel(0x2222, "energyString")
mylabel(0x222b, "mode4EtcString")
mylabel(0x223d, "shieldsOnString")
mylabel(0x224c, "shieldsOffString")
string(0x223d, 2)
mylabel_with_comment(0x22bd, "turnShieldsOn")
mylabel_with_comment(0x22c9, "turnShieldsOff")

mylabel(0x22a5, "loop")
mylabel(0x22b3, "loop")
mylabel(0x22bf, "loop")
mylabel(0x22cb, "loop")
mylabel_with_comment(0x22b1, "setMode4Etc")
mylabel_with_comment(0x22a3, "showEnergyString")
mylabel_with_comment(0x3912, "anEscapeCapsuleWasLaunchedString")
mylabel_with_comment(0x3997, "beforeTheStarshipExplodedString")
mylabel_with_comment(0x39bd, "afterYourPerformanceOnThisCommandString")
mylabel_with_comment(0x3a1f, "andReturnedSafelyString")
mylabel_with_comment(0x3a4e, "butCollidedWithAnEnemyShipString")
mylabel_with_comment(0x3a72, "havingJustGainedString")
mylabel_with_comment(0x3a8c, "andButTheyAllowYouTheCommandOfAnotherString")
mylabel_with_comment(0x3ac6, "emotionalResponseString")
mylabel_with_comment(0x3b1b, "andTheyRetireYouString")
mylabel_with_comment(0x3d92, "starshipControlsString")
expr(0x4017, "<starshipControlsString")
expr(0x401b, ">starshipControlsString")
expr(0x4023, "'~'")
mylabel_with_comment(0x4016, "displayStarshipControls")
mylabel_with_comment(0x4020, "displayControlsLoop")
mylabel_with_comment(0x404c, "displayLineBreak")
mylabel_with_comment(0x4494, "enterYourNameString")
mylabel(0x4031, "displayLineBreaks")
expr(0x43e5, "<starfleet_records_string")
expr(0x43e9, ">starfleet_records_string")
expr(0x453c, "<enterYourNameString")
expr(0x4540, ">enterYourNameString")
mylabel(0x44e1, "readLineData")
mylabel(0x44d3, "readLineStringBuffer")
word(0x44e1, 1)
expr(0x44e1, "readLineStringBuffer")

mylabel(0x21bc, "unused")
mylabel(0x226f, "unused")
mylabel(0x3fd2, "unused")
mylabel(0x4041, "unused")
mylabel(0x4321, "unused")
mylabel(0x44e6, "unused")
mylabel(0x43b5, "unused")
mylabel(0x4528, "scoreIsZero")

mylabel_with_comment(0x2336, "setCursorStyle")
mylabel(0x2338, "loop")
mylabel(0x18e4, "plotSegment")

mylabel_with_comment(0x44e8, "checkForHighScore")
mylabel_with_comment(0x4335, "highscoreTableData", "There are eight entries of 16 bytes each. The first three bytes are the score, then 13 bytes for the name")
expr_label(0x4336, "highscoreTableData+1")
expr_label(0x4337, "highscoreTableData+2")
expr_label(0x4345, "highscoreTableData+16")
mylabel(0x4338, "highscoreTableDataName")

mylabel(0x0f4a, "plotPixelAroundOrigin")
mylabel(0x0e98, "segment_angle_to_x_y_deltas_table")

# Memory locations for entry point
#entry(0x61b1, "entry_point")
#label(0x61ca, "relocate_loop")
#label(0x61da, "not_done")
#label(0x61f6, "done_relocating")
label(0x61b1, "entry_point")

# Actual start
entry(0x47b1, "start")

# unused code
entry(0x232a, "enable_cursor")

# from level7dis
mylabel(0x0400, "enemy_ships_previous_on_screen")
mylabel(0x0401, "enemy_ships_previous_x_fraction")
mylabel(0x0402, "enemy_ships_previous_x_pixels")
mylabel(0x0403, "enemy_ships_previous_x_screens")
mylabel(0x0404, "enemy_ships_previous_x_fraction")
mylabel(0x0405, "enemy_ships_previous_x_pixels")
mylabel(0x0406, "enemy_ships_previous_x_screens")
mylabel(0x0407, "enemy_ships_previous_angle")
mylabel(0x0408, "enemy_ships_velocity")
mylabel(0x0409, "enemy_ships_flags_or_explosion_timer")
mylabel(0x040a, "enemy_ships_type")
mylabel(0x0480, "enemy_ships_on_screen")
mylabel(0x0481, "enemy_ships_x_fraction")
mylabel(0x0482, "enemy_ships_x_pixels")
mylabel(0x0483, "enemy_ships_x_screens")
mylabel(0x0484, "enemy_ships_x_fraction")
mylabel(0x0485, "enemy_ships_x_pixels")
mylabel(0x0486, "enemy_ships_x_screens")
mylabel(0x0487, "enemy_ships_angle")
mylabel(0x0488, "enemy_ships_temporary_behaviour_flags")
mylabel(0x0489, "enemy_ships_energy")
mylabel(0x048a, "enemy_ships_firing_cooldown")
mylabel(0x0c00, "user_defined_characters")
expr_label(0x0c10, "user_defined_characters + 16")


mylabel(0x0e2d, "number_of_delay_loops")
mylabel(0x0e2e, "enemy_ship_was_previously_on_screen")
mylabel(0x0e2f, "enemy_ship_was_on_screen")
mylabel(0x0e30, "additional_damage_from_collision_with_enemy_ship")
mylabel(0x0e31, "damage_enemy_ship_incurs_from_collision_with_other_enemy_ship")
mylabel(0x0e32, "starship_angle_fraction")
mylabel(0x0e33, "starship_angle_delta")
mylabel(0x0e34, "damage_to_enemy_ship_from_starship_torpedo")
mylabel(0x0e35, "maximum_number_of_explosions")
mylabel(0x0e36, "value_used_for_enemy_torpedo_ttl")
mylabel(0x0e37, "frame_of_enemy_ship_explosion_after_which_no_collisions")
mylabel(0x0e38, "frame_of_enemy_ship_explosion_after_which_no_segments_are_plotted")
mylabel(0x0e39, "enemy_ship_explosion_duration")
mylabel(0x0e3a, "size_of_enemy_ship_for_collisions_with_torpedoes")
mylabel(0x0e3b, "size_of_enemy_ship_for_collisions_between_enemy_ships")
mylabel(0x0e3d, "enemy_torpedo_table_address_low")
mylabel(0x0e3e, "enemy_torpedo_table_address_high")
mylabel(0x0e3f, "unused")
mylabel(0x0e41, "bit_table")
mylabel(0x0e49, "star_table_address_low")
mylabel(0x0e4a, "star_table_address_high")
mylabel(0x0e4b, "starship_torpedo_table_address_low")
mylabel(0x0e4c, "starship_torpedo_table_address_high")
mylabel(0x0e4d, "starship_torpedo_tail_table_address_low")
mylabel(0x0e4e, "starship_torpedo_tail_table_address_high")
mylabel(0x0e4f, "maximum_number_of_enemy_ships")
mylabel(0x0e50, "maximum_number_of_stars")
mylabel(0x0e51, "maximum_number_of_starship_torpedoes")
mylabel(0x0e52, "maximum_number_of_enemy_torpedoes")
mylabel(0x0e53, "starship_torpedoes_time_to_live")
mylabel(0x0e54, "enemy_ships_still_to_consider")
mylabel(0x0e55, "torpedoes_still_to_consider")
mylabel(0x0e56, "starship_shields_active")
mylabel(0x0e57, "unused")
mylabel(0x0e58, "sine_table")
mylabel(0x0e78, "cosine_table")
mylabel(0x0e98, "segment_angle_to_x_y_deltas_table")

mylabel(0x0eb8, "unused")
mylabel(0x0ebe, "starship_rotation_cosine_table")
mylabel(0x0ec4, "starship_rotation_sine_table")
mylabel(0x0eca, "unused")
mylabel(0x0ed0, "rotated_x_correction_lsb")
mylabel(0x0ed6, "rotated_x_correction_screens")
mylabel(0x0edc, "rotated_y_correction_lsb")
mylabel(0x0ee2, "rotated_y_correction_screens")
mylabel(0x0ee8, "rotated_x_correction_fraction")
mylabel(0x0eee, "rotated_x_correction_pixels")
mylabel(0x0ef4, "rotated_y_correction_fraction")
mylabel(0x0efa, "rotated_y_correction_pixels")
mylabel(0x0f00, "starship_velocity_high")
mylabel(0x0f01, "starship_velocity_low")
mylabel(0x0f02, "starship_rotation")
mylabel(0x0f03, "starship_rotation_magnitude")
mylabel(0x0f04, "starship_rotation_cosine")
mylabel(0x0f05, "starship_rotation_sine_magnitude")
mylabel_with_comment(0x0f06, "set_pixel")
mylabel_with_comment(0x0f0e, "unset_pixel")
mylabel_with_comment(0x0f18, "calculate_pixel_address")
mylabel(0x0f45, "unused_infinite_loop")
mylabel_with_comment(0x0f4a, "eor_pixel_within_box_around_origin")
mylabel(0x0f53, "skip_inversion_x")
mylabel(0x0f60, "skip_inversion_y")
mylabel(0x0f64, "eor_pixel")
mylabel(0x0f95, "unused")
mylabel(0x0f99, "return")
mylabel_with_comment(0x0f9a, "multiply_torpedo_position_by_starship_rotation_sine_magnitude")
mylabel(0x0fac, "loop_over_bits_of_input")
mylabel(0x0fb5, "input_bit_unset")
mylabel_with_comment(0x0fbe, "multiply_torpedo_position_by_starship_rotation_cosine")
mylabel(0x0fc7, "loop_over_bits_of_multiplier")
mylabel(0x0fce, "multiplier_bit_unset")
mylabel(0x0fe5, "return")
mylabel_with_comment(0x0fe6, "update_object_position_for_starship_rotation_and_speed")
mylabel(0x0ffc, "skip_inversion")
mylabel_with_comment(0x100d, "update_position_for_rotation")
mylabel(0x105e, "skip_uninversion")
mylabel(0x106f, "add_starship_velocity_to_position")
mylabel_with_comment(0x1081, "multiply_enemy_position_by_starship_rotation_sine_magnitude")
mylabel(0x1099, "loop_over_bits_of_input")
mylabel(0x10a4, "input_bit_unset")
mylabel_with_comment(0x10af, "multiply_enemy_position_by_starship_rotation_cosine")
mylabel(0x10c2, "loop_over_bits_of_input")
mylabel(0x10cb, "input_bit_unset")
mylabel_with_comment(0x10fb, "apply_starship_rotation_and_velocity_to_enemy_ships")
mylabel(0x1106, "starship_is_rotating")
mylabel(0x1114, "skip")
mylabel(0x1122, "skip")
mylabel(0x113f, "skip_inversion")
mylabel(0x11b6, "skip_uninversion")
mylabel(0x11f1, "apply_starship_velocity_to_enemy_ship")
mylabel_with_comment(0x120d, "brief_delay_80")
mylabel(0x1211, "brief_delay_40")
mylabel(0x1213, "brief_delay_loop")
mylabel_with_comment(0x1219, "plot_starship_torpedoes")
mylabel(0x1233, "plot_starship_torpedoes_loop")
mylabel(0x123c, "torpedo_present")
mylabel(0x124c, "torpedo_still_alive")
mylabel(0x12d5, "unplot_torpedo")
mylabel(0x12d8, "update_next_torpedo")
mylabel(0x12e3, "skip")
mylabel(0x12ee, "skip")
mylabel(0x12f6, "return")
mylabel_with_comment(0x12f7, "fire_starship_torpedo")
mylabel(0x1311, "loop")
mylabel(0x1322, "return")
mylabel_with_comment(0x1323, "empty_torpedo_slot")
mylabel(0x1360, "return")
mylabel(0x1361, "unused")
mylabel_with_comment(0x1362, "plot_big_torpedo")
mylabel_with_comment(0x138a, "plot_expiring_torpedo")
mylabel_with_comment(0x13d0, "update_stars")
mylabel(0x13e0, "update_stars_loop")
mylabel(0x1402, "skip")
mylabel_with_comment(0x1408, "unplot_long_range_scanner_if_shields_inactive")
mylabel(0x142a, "unused")
mylabel_with_comment(0x142b, "plot_top_and_right_edge_of_long_range_scanner_with_blank_text")
mylabel_with_comment(0x1438, "plot_top_and_right_edge_of_long_range_scanner_without_text")
mylabel(0x1442, "plot_top_edge_loop")
mylabel(0x144f, "plot_right_edge_loop")
mylabel(0x1458, "return")
mylabel(0x1459, "unused")
mylabel_with_comment(0x145a, "plot_starship_torpedo")
mylabel(0x1471, "small_starship_torpedoes")
mylabel(0x14a1, "unused")
mylabel_with_comment(0x14a4, "apply_rotation_to_starship_angle")

mylabel(0x14b6, "add_fraction")
mylabel(0x14be, "skip")
mylabel(0x14c3, "subtract_fraction")
mylabel(0x14cb, "skip")
mylabel(0x14ce, "set_starship_angle_fraction")
mylabel(0x14d1, "return")
mylabel_with_comment(0x14d2, "update_enemy_torpedoes")
mylabel(0x14e7, "update_enemy_torpedoes_loop")
mylabel_with_comment(0x14f0, "enemy_torpedo_in_slot")
mylabel(0x14fd, "enemy_torpedo_still_alive")
mylabel(0x1523, "skip_inversion")
mylabel(0x1538, "skip_uninversion")
mylabel(0x153c, "remove_torpedo")
mylabel_with_comment(0x1544, "consider_collisions")
mylabel(0x1573, "enemy_torpedo_missed_starship")
mylabel(0x1586, "enemy_torpedo_ok")
mylabel(0x1589, "move_to_next_enemy_torpedo")
mylabel(0x159c, "finished_updating_torpedoes")
mylabel(0x1594, "skip")
mylabel_with_comment(0x159d, "check_for_collision_with_enemy_ships")
mylabel(0x15b1, "consider_enemy_slot")
mylabel(0x15c0, "skip_inversion_x")
mylabel(0x15cf, "skip_inversion_y")
mylabel(0x15e3, "skip_considering_explosion")
mylabel(0x15f4, "damaged_by_other")
mylabel(0x15f7, "collision_occurred")
mylabel(0x15fa, "skip_damage")
mylabel(0x1605, "move_to_next_enemy")
mylabel(0x1611, "plot_enemy_torpedo")
mylabel(0x1620, "enemy_torpedo_type_instruction")
mylabel(0x1631, "apply_velocity_to_enemy_ships")
mylabel(0x1639, "apply_velocity_to_enemy_ships_loop")
mylabel(0x1664, "loop_over_bits_of_sine")
mylabel(0x166b, "sine_bit_unset")
mylabel(0x1686, "skip")
mylabel(0x1695, "skip_subtraction_sine")
mylabel(0x169b, "loop_over_bits_of_cosine")
mylabel(0x16a2, "cosine_bit_unset")
mylabel(0x16bd, "skip")
mylabel(0x16cc, "skip_subtraction_cosine")
mylabel(0x16cc, "mark_enemy_ship_as_plotted_if_on_starship_screen")
mylabel(0x16dc, "enemy_ship_not_on_starship_screen")
mylabel(0x16de, "set_enemy_ships_on_screen")
mylabel(0x16ee, "return")
mylabel(0x16ef, "unused")
mylabel(0x16f2, "plot_enemy_ships")
mylabel(0x16fa, "plot_enemy_ships_loop")
mylabel(0x1721, "not_previously_on_screen")
mylabel(0x1729, "explosion_continuing")
mylabel(0x1729, "enemy_ship_isn't_exploding")
mylabel(0x173b, "not_on_screen")
mylabel(0x173e, "skip_extra_delay")
mylabel(0x174b, "unplot_enemy_ship")
mylabel(0x174e, "skip_plotting")
mylabel(0x176d, "plot_enemy_ship_and_copy_position")
mylabel(0x1770, "copy_position_without_plotting")
mylabel(0x179b, "return")
mylabel(0x179c, "delay_loop")
mylabel(0x179e, "delay_loop_outer_loop")
mylabel(0x17a0, "delay_loop_inner_loop")
mylabel(0x17a7, "unused")
mylabel(0x17b2, "shield_state_strings")
mylabel(0x17c7, "unused")
mylabel(0x17d1, "enemy_ships_collided_with_each_other")
mylabel(0x17d2, "unused")
mylabel(0x17d8, "check_for_starship_collision_with_enemy_ships")
mylabel(0x17e2, "check_for_starship_collision_with_enemy_ships_loop")
mylabel(0x17f6, "to_consider_next_enemy_ship")
mylabel(0x17f9, "check_for_collision")
mylabel(0x1806, "starship_not_exploded")
mylabel(0x183d, "incur_damage_from_passing_through_explosion")
mylabel(0x1841, "incur_damage_from_collision")
mylabel(0x1844, "no_collision")
mylabel(0x1850, "check_for_collisions_between_enemy_ships")
mylabel(0x186a, "skip_inversion_x")
mylabel(0x187d, "skip_inversion_y")
mylabel(0x1894, "second_ship_not_exploding")
mylabel(0x189f, "skip")
mylabel(0x18b8, "enemy_ship_isnt_destroyed_by_collision")
mylabel(0x18c9, "to_collide_enemy_ships")
mylabel(0x18cc, "consider_next_second_enemy_ship")
mylabel(0x18d4, "consider_next_enemy_ship")
mylabel(0x18e3, "return")
mylabel(0x18ec, "consider_change_to_x")
mylabel(0x18f6, "bit_1_unset")
mylabel(0x18f9, "bit_2_set")
mylabel(0x18fb, "consider_change_to_y")
mylabel(0x1905, "bit_3_unset")
mylabel(0x1908, "bit_4_set")
mylabel(0x190a, "make_changes")
mylabel(0x191d, "starship_energy_high")
mylabel(0x191f, "damage_low")
mylabel(0x1918, "starship_torpedo_cooldown")
mylabel(0x1919, "starship_torpedo_cooldown_after_firing")
mylabel(0x191a, "fire_pressed")
mylabel(0x191b, "unused")
mylabel(0x191c, "starship_energy_low")
mylabel(0x191d, "starship_energy_high")
mylabel(0x191e, "damage_high")
mylabel(0x191f, "damage_low")
mylabel(0x1920, "starship_destroyed")
mylabel(0x1921, "minimum_energy_value_to_avoid_starship_destruction")
mylabel(0x1922, "starship_energy_divided_by_sixteen")
mylabel(0x1923, "starship_energy_regeneration")
mylabel(0x1924, "starship_automatic_shields")
mylabel(0x1925, "value_of_x_when_incur_damage_called")
mylabel(0x1926, "shields_state_delta")
mylabel(0x1927, "rotation_delta")
mylabel(0x1928, "starship_rotation_fraction")
mylabel(0x1929, "strength_of_player_rotation")
mylabel(0x192a, "strength_of_rotation_dampers")
mylabel(0x192b, "starship_energy_drain_from_acceleration")
mylabel(0x192c, "rotation_damper")
mylabel(0x192d, "starship_energy_drain_from_non_zero_rotation")
mylabel(0x192e, "velocity_delta")
mylabel(0x192f, "starship_acceleration_from_player")
mylabel(0x1930, "starship_acceleration_from_velocity_damper")
mylabel(0x1931, "velocity_damper")
mylabel(0x1932, "maximum_starship_velocity")
mylabel(0x1933, "enemy_ship_x_plus_half_sine")
mylabel(0x1934, "enemy_ship_y_plus_half_cosine")
mylabel(0x1935, "enemy_ship_type")
mylabel(0x1936, "starship_torpedo_counter")
mylabel(0x1937, "starship_torpedoes_per_round")
mylabel(0x1938, "starship_torpedo_cooldown_after_round")
mylabel(0x1939, "starship_energy_drain_from_firing_torpedo")
mylabel(0x193a, "previous_starship_automatic_shields")
mylabel(0x193b, "unused")
mylabel(0x193f, "handle_player_movement")
mylabel(0x1958, "reset_starship_torpedo_round")
mylabel(0x195e, "skip_reset_starship_torpedo_round")
mylabel(0x1969, "starship_isnt_destroyed")
mylabel(0x1979, "player_is_accelerating")
mylabel(0x198c, "skip")
mylabel(0x19a1, "starship_is_decelerating")
mylabel(0x19a4, "set_deceleration")
mylabel(0x19c0, "incur_damage_from_acceleration")
mylabel(0x19c6, "finished_accelerating")
mylabel(0x19e2, "starship_was_turned_clockwise")
mylabel(0x19e9, "player_is_turning")
mylabel(0x19ef, "store_rotation")
mylabel(0x19ff, "player_is_turning_clockwise")
mylabel(0x1a03, "set_starship_rotation_fraction_and_consider_rotating")
mylabel(0x1a11, "set_starship_rotation_fraction")
mylabel(0x1a17, "rotate_starship_clockwise")
mylabel(0x1a1c, "rotate_starship_anticlockwise")
mylabel(0x1a1f, "continue")
mylabel(0x1a29, "skip_inversion")
mylabel(0x1a3b, "incur_energy_drain_from_rotation")
mylabel(0x1a41, "finished_rotating")
mylabel(0x1a5c, "not_end_of_round")
mylabel(0x1a5f, "set_starship_torpedo_cooldown")
mylabel(0x1a70, "player_isnt_firing")
mylabel(0x1a83, "skip_shield_activation")
mylabel(0x1a9b, "plot_shields_on_and_consider_activation")
mylabel(0x1aa1, "return")
mylabel(0x1aa2, "unused")
mylabel(0x1aa3, "incur_damage")
mylabel(0x1ab1, "skip")
mylabel(0x1ab7, "shields_are_active")
mylabel(0x1aba, "incur_low_damage")
mylabel(0x1ac6, "return")
mylabel(0x1af3, "skip")
mylabel(0x1b05, "starship_still_has_energy")
mylabel(0x1b12, "skip")
mylabel(0x1ac7, "update_various_starship_statuses_on_screen")
mylabel(0x1ad0, "unused")
mylabel(0x1ad1, "apply_damage_to_starship_energy")
mylabel(0x1b1c, "reset_damage_counter")
mylabel(0x1b43, "skip_destruction")
mylabel(0x1b48, "plot_starship_energy_bars")
mylabel(0x1b57, "skip_swapping_start_and_end")
mylabel(0x1b5d, "calculate_pixel_position_in_bar")
mylabel(0x1b67, "finished_calculating_pixel_position_in_bar")
mylabel(0x1b77, "plot_energy_change_loop")
mylabel(0x1b96, "skip_moving_to_next_bar")
mylabel(0x1ba0, "return")
mylabel(0x1ba1, "activate_shields_when_enemy_ship_enters_main_square")
mylabel(0x1ba9, "activate_shields_when_enemy_ship_enters_main_square_loop")
mylabel(0x1bc0, "enemy_ship_is_on_screen")
mylabel(0x1be7, "damage_enemy_ship")
mylabel(0x1bc8, "return")
mylabel(0x1bc9, "unused")
mylabel(0x1bcf, "plot_vertical_line")
mylabel(0x1bd1, "plot_vertical_line_loop")
mylabel(0x1bdb, "plot_horizontal_line")
mylabel(0x1bdd, "plot_horizontal_line_loop")
mylabel(0x1bf3, "skip")
mylabel(0x1bfb, "return")
mylabel(0x1bfc, "plot_enemy_ship")
mylabel(0x1c0b, "enemy_ship_isnt_cloaked")
mylabel(0x1c2a, "skip_set_carry_sine")
mylabel(0x1c38, "skip_set_carry_cosine")
mylabel(0x1c9c, "regular_ship")
mylabel(0x1ca4, "long_ship")
mylabel(0x1cc6, "enemy_ship_is_cloaked")
mylabel(0x1cc9, "starship_has_exploded")
mylabel(0x1cca, "starship_explosion_address_low")
mylabel(0x1ccb, "starship_explosion_address_high")
mylabel(0x1ccc, "starship_explosion_size")
mylabel(0x1ccd, "maximum_starship_explosion_countdown")
mylabel(0x1cce, "starship_explosion_countdown")
mylabel(0x1ccf, "number_of_bytes_per_enemy_explosion")
mylabel(0x1cd0, "create_new_enemy_explosion_piece_after_one_dies")
mylabel(0x1cd1, "rnd_1")
mylabel(0x1cd2, "rnd_2")
mylabel(0x1cd3, "unused")
mylabel(0x1cd6, "keyboard_or_joystick")
mylabel(0x1cd7, "sound_enabled")
mylabel(0x1cd8, "escape_capsule_launched")
mylabel(0x1cd9, "damage_from_enemy_torpedo")
mylabel(0x1cda, "frame_of_starship_explosion_after_which_no_sound")
mylabel(0x1cdb, "escape_capsule_sound_channel")
mylabel(0x1cdc, "enemy_ship_fired_torpedo")
mylabel(0x1cdd, "enemy_torpedo_hits_against_starship")
mylabel(0x1cde, "enemy_ship_was_hit")
mylabel(0x1cdf, "damage_to_enemy_ship_from_other_collision")
mylabel(0x1ce0, "how_enemy_ship_was_damaged")
mylabel(0x1ce1, "unused")
expr_label(0x1ce1, "enemy_ships_explosion_number - 1")
mylabel(0x1ce2, "enemy_ships_explosion_number")
mylabel(0x1cea, "unused")
expr_label(0x1cf6, "enemy_explosion_address_low_table - 1")
mylabel(0x1cf7, "enemy_explosion_address_low_table")
mylabel(0x1d07, "unused")
expr_label(0x1d07, "enemy_explosion_address_high_table - 1")
byte(0x1d08, 16, 1)
mylabel(0x1d08, "enemy_explosion_address_high_table")
mylabel(0x1d18, "enemy_explosion_piece_ageing_table")
mylabel(0x1d1c, "starship_explosion_piece_ageing_table")
mylabel(0x1d24, "plot_stars")
mylabel(0x1d34, "plot_stars_loop")
mylabel(0x1d4e, "skip")
mylabel(0x1d54, "unused")
mylabel(0x1d58, "initialise_stars_at_random_positions")
mylabel(0x1d68, "initialise_stars_at_random_positions_loop")
mylabel(0x1d84, "skip")
mylabel(0x1d8a, "unused")
mylabel(0x1d8e, "plot_starship")
mylabel(0x1d90, "plot_starship_top_loop")
mylabel(0x1d9e, "plot_starship_bottom_loop")
mylabel(0x1dab, "unused")
mylabel(0x1daf, "explode_starship")
mylabel(0x1dbf, "plot_starship_explosion_loop")
mylabel(0x1dcd, "skip")
mylabel(0x1de3, "unused")
mylabel(0x1de8, "plot_starship_explosion")
mylabel(0x1df0, "starship_explosion_continuing")
mylabel(0x1e00, "loop")
mylabel(0x1e1e, "skip")
mylabel(0x1e2b, "move_to_next_starship_explosion_piece")
mylabel(0x1e36, "skip")
mylabel(0x1e3c, "unused")
mylabel(0x1e3d, "plot_starship_explosion_piece")
mylabel(0x1e5b, "skip_inversion_sine")
mylabel(0x1e67, "skip_inversion_cosine")
mylabel(0x1e6d, "loop_over_bits_of_sine")
mylabel(0x1e74, "sine_bit_unset")
mylabel(0x1e7e, "skip_uninversion_sine")
mylabel(0x1e86, "loop_over_bits_of_cosine")
mylabel(0x1e8d, "skip")
mylabel(0x1e97, "skip_uninversion_cosine")
mylabel(0x1ec6, "plot_variable_size_fragment")
mylabel(0x1efe, "return")
mylabel(0x1eff, "unused")
mylabel(0x1f03, "initialise_starship_explosion_pieces")
mylabel(0x1f19, "initialise_starship_explosion_pieces_loop")
mylabel(0x1f27, "skip")
mylabel(0x1f2d, "initialise_starship_explosion_piece")
mylabel(0x1f4d, "not_a_segment")
mylabel(0x1f5d, "explode_enemy_ship")
mylabel(0x1f65, "skip_unplotting")
mylabel(0x1f70, "find_free_explosion_slot_loop")
mylabel(0x1f78, "skip")
mylabel(0x1f83, "too_many_explosions")
mylabel(0x1f9a, "enemy_explosion_initialisation_loop")
mylabel(0x1fb2, "unused")
mylabel(0x1fb4, "update_enemy_explosion_pieces")
mylabel(0x1fc0, "skip")
mylabel(0x1fc9, "update_enemy_explosion_pieces_loop")
mylabel(0x1ff5, "piece_still_active")
mylabel(0x2001, "move_to_next_piece_after_dey")
mylabel(0x2002, "move_to_next_piece")
mylabel(0x2008, "unused")
mylabel(0x200c, "plot_enemy_ship_explosion")
mylabel(0x2012, "plot_enemy_ship_explosion_loop")
mylabel(0x201b, "move_to_next_explosion_piece")
mylabel(0x2021, "unused")
mylabel(0x2025, "plot_enemy_explosion_fragment")
mylabel(0x203f, "skip_inversion_sine")
mylabel(0x204b, "skip_inversion_cosine")
mylabel(0x2051, "loop_over_bits_of_sine")
mylabel(0x2058, "sine_bit_unset")
mylabel(0x2062, "skip_uninversion_sine")
mylabel(0x206b, "loop_over_bits_of_cosine")
mylabel(0x2072, "cosine_bit_unset")
mylabel(0x207c, "skip_uninversion_cosine")
mylabel(0x209d, "leave_after_restoring_y")
mylabel(0x20a0, "unused")
mylabel(0x20a4, "plot_enemy_ship_or_explosion_segments")
mylabel(0x20c1, "return")
mylabel(0x20c2, "unused")
mylabel(0x2123, "random_number_generator_loop")
mylabel(0x20c5, "plot_enemy_explosion_segments")
mylabel(0x210f, "unused")
mylabel(0x2113, "random_number_generator")
mylabel(0x2123, "random_number_generator_loop")
mylabel(0x212c, "lowest_bit_unset")
mylabel(0x2140, "unused")
mylabel(0x2146, "game_key_table")
mylabel(0x2155, "unused")
mylabel(0x215a, "screen_border_string")
mylabel(0x2184, "envelope1")
mylabel(0x2192, "envelope2")
mylabel(0x21a0, "envelope3")
mylabel(0x21ae, "envelope4")
mylabel(0x21bc, "unused")
mylabel_with_comment(0x21c8, "sound_1", "Exploding starship 1")
mylabel(0x21cc, "sound_1_pitch")
mylabel_with_comment(0x21d0, "sound_2", "Exploding starship 2")
mylabel(0x21d2, "sound_1_volume_low")
mylabel(0x21d3, "sound_1_volume_high")
mylabel_with_comment(0x21d8, "sound_3", "Starship fired torpedo")
mylabel_with_comment(0x21e0, "sound_4", "Enemy ship fired torpedo")
mylabel_with_comment(0x21e8, "sound_5", "Enemy ship hit by torpedo")
mylabel_with_comment(0x21f0, "sound_6", "Starship hit by torpedo")
mylabel_with_comment(0x21f8, "sound_7", "Enemy ships collided with each other")
mylabel_with_comment(0x2200, "sound_8", "Escape capsule launched")
mylabel(0x2202, "sound_8_volume_low")
mylabel(0x2203, "sound_8_volume_high")
mylabel_with_comment(0x2208, "sound_9", "Low energy warning")
mylabel(0x221c, "set_background_colour_to_black_string")
mylabel(0x2222, "energy_string")
mylabel(0x222b, "one_two_three_four_string")
mylabel(0x223d, "shields_string")
mylabel(0x224c, "blank_string")
mylabel(0x225b, "enable_cursor_string")
mylabel(0x2265, "disable_cursor_string")
mylabel(0x226f, "unused")
mylabel(0x2275, "plot_energy_bar_edges")
mylabel(0x227f, "plot_energy_bar_edges_loop")
mylabel_with_comment(0x22d5, "initialise_envelopes")
mylabel(0x22fa, "plot_screen_border")
mylabel(0x2306, "set_foreground_colour_to_white")
mylabel(0x2312, "set_foreground_colour_to_black")
mylabel(0x231e, "set_background_colour_to_black")
mylabel(0x232c, "enable_cursor_loop")
mylabel(0x2338, "disable_cursor_loop")
mylabel(0x2342, "unused")
mylabel(0x234b, "check_for_keypresses")
mylabel(0x235e, "use_keyboard_input")
mylabel(0x236a, "not_rotate_anticlockwise")
mylabel(0x2372, "not_rotate_clockwise")
mylabel(0x237a, "not_accelerate")
mylabel(0x2382, "not_decelerate")
mylabel(0x238a, "check_for_additional_keys")
mylabel(0x2392, "not_launch_starboard_escape_capsule")
mylabel(0x239a, "not_launch_port_escape_capsule")
mylabel(0x23a5, "is_keyboard")
mylabel(0x23b7, "return")
mylabel(0x23b8, "not_enable_rotation_damper")
mylabel(0x23c3, "not_enable_velocity_damper")
mylabel(0x23ce, "not_disable_rotation_damper")
mylabel(0x23d9, "skip_damper_keys")
mylabel(0x23e2, "not_enable_shields")
mylabel(0x23eb, "not_disable_shields")
mylabel(0x23f6, "unused")
mylabel(0x23fe, "not_unused_copy")
mylabel(0x2406, "not_unused_shift_one")
mylabel(0x240e, "not_unused_shift_two")
mylabel(0x2416, "not_unused_shift_three")
mylabel(0x241e, "check_for_copy")
mylabel(0x2426, "return")
mylabel(0x2427, "unused")
mylabel(0x2436, "check_key")
mylabel(0x2446, "unused")
mylabel(0x2449, "pause_game")
mylabel(0x2456, "unused")
mylabel(0x245a, "play_sounds")
mylabel(0x2460, "sound_is_enabled")
mylabel(0x2470, "no_enemy_torpedo_hits_against_starship")
mylabel(0x247b, "no_enemy_ship_was_hit")
mylabel(0x2484, "play_explosion_or_firing_sound")
mylabel(0x2489, "skip_explosion_or_firing_sound")
mylabel(0x2496, "set_escape_capsule_sound_channel")
mylabel(0x24b3-4, "skip_sound_for_exploding_enemy_ship")
mylabel(0x24bb-4, "escape_capsule_not_launched")
mylabel(0x24cf-4, "play_starship_engine_sound")
mylabel(0x24ec-4, "skip_ceiling")
mylabel(0x2506-4, "play_sound_for_exploding_starship")
mylabel(0x251a-4, "skip_pitch_bend")
mylabel(0x2527-4, "skip_ceiling")
mylabel(0x2547-4, "skip_starship_explosion_sound")
mylabel(0x2551-4, "play_escape_capsule_sound")
mylabel(0x2567-4, "set_volume")
mylabel(0x256e-4, "set_volume_high")
mylabel(0x2581-4, "consider_torpedo_sound")
mylabel(0x258f-4, "skip_starship_torpedo_sound")
mylabel(0x259e-4, "unused")
mylabel(0x2599, "return")
mylabel(0x25d5, "starship_maximum_x_for_collisions_with_enemy_torpedoes")
mylabel(0x25d6, "starship_minimum_x_for_collisions_with_enemy_torpedoes")
mylabel(0x25d7, "starship_maximum_y_for_collisions_with_enemy_torpedoes")
mylabel(0x25d8, "starship_minimum_y_for_collisions_with_enemy_torpedoes")
mylabel(0x25d9, "starship_maximum_x_for_collisions_with_enemy_ships")
mylabel(0x25da, "starship_minimum_x_for_collisions_with_enemy_ships")
mylabel(0x25db, "starship_maximum_y_for_collisions_with_enemy_ships")
mylabel(0x25dc, "starship_minimum_y_for_collisions_with_enemy_ships")
mylabel(0x25dd, "enemy_ship_was_hit_by_collision_with_other_enemy_ship")
mylabel(0x25de, "starship_collided_with_enemy_ship")
mylabel(0x25df, "frame_of_starship_explosion_after_which_no_collisions")
mylabel(0x25e0, "enemy_ships_collision_x_difference")
mylabel(0x25e1, "enemy_ships_collision_y_difference")
mylabel(0x25e2, "unused")
mylabel(0x25f0, "timer_for_low_energy_warning_sound")
mylabel(0x25f1, "sound_needed_for_low_energy")
mylabel(0x25f2, "energy_flash_timer")
mylabel(0x25f3, "flash_energy_when_low")
mylabel(0x260a, "energy_is_already_low")
mylabel(0x2614, "consider_warning_sound")
mylabel(0x2628, "return")
mylabel(0x2629, "invert_energy_text")
mylabel(0x262b, "invert_energy_text_loop")
mylabel(0x2637, "unused")
mylabel(0x2652, "enemy_ships_can_cloak")
mylabel(0x2653, "probability_of_enemy_ship_cloaking")
mylabel(0x2654, "minimum_energy_for_enemy_ship_to_cloak")
mylabel(0x2655, "enemy_ship_desired_angle_divided_by_eight")
mylabel(0x2656, "unused")
mylabel(0x2657, "number_of_live_starship_torpedoes")
mylabel(0x2658, "starship_fired_torpedo")
mylabel(0x2659, "scanner_failure_duration")
mylabel(0x265a, "starship_shields_active_before_failure")
mylabel(0x265b, "starship_torpedo_type")
mylabel(0x265c, "unused")
mylabel(0x2667, "handle_enemy_ships_cloaking")

mylabel(0x2674, "handle_enemy_ships_cloaking_loop")
mylabel(0x2681, "enemy_ship_is_already_cloaked")
mylabel(0x268e, "enemy_ship_is_on_screen")
mylabel(0x26a5, "enemy_ship_has_sufficient_energy_to_cloak")
mylabel(0x26bf, "handle_enemy_ships_cloaking_next")
mylabel(0x26c9, "return")
mylabel(0x26ca, "unused")
mylabel(0x26cc, "fire_enemy_torpedo")
mylabel(0x26da, "find_enemy_torpedo_slot_loop")
mylabel(0x26e9, "skip")
mylabel(0x26ee, "leave_after_clearing_carry")
mylabel(0x26f0, "free_slot")
mylabel(0x2712, "single_torpedo")
mylabel(0x2756, "skip")
mylabel(0x2758, "calculate_enemy_ship_angle_to_starship")
mylabel(0x2762, "skip_inversion_y")
mylabel(0x2773, "skip_inversion_x")
mylabel(0x2784, "skip_swap")
mylabel(0x278c, "division_loop")
mylabel(0x2795, "still_less_than")
mylabel(0x27b4, "finished_calculating_partial_angle")
mylabel(0x27b5, "adjust_angle_for_inversions_and_swap")
mylabel(0x27bd, "skip_angle_swap")
mylabel(0x27c5, "skip_angle_inversion_x")
mylabel(0x27cd, "skip_angle_inversion_x")
mylabel(0x27d3, "ninety_degrees")
mylabel(0x27d7, "unused")
mylabel(0x27e0, "collide_enemy_ships")
mylabel(0x27ef, "skip_floor")
mylabel(0x27fa, "first_ship_survives_collision")
mylabel(0x280b, "first_ship_is_already_exploding")
mylabel(0x282f, "skip_inversion")
mylabel(0x2836, "angle_loop")
mylabel(0x283f, "skip_velocity_absorption")
mylabel(0x285a, "use_x_pixels_and_difference")
mylabel(0x2876, "dont_swap_two_ships_for_collision")
mylabel(0x2881, "dont_alter_first_ships_position")
mylabel(0x288c, "dont_alter_second_ships_position")
mylabel(0x288f, "unused")
mylabel(0x2890, "escape_capsule_destroyed")
mylabel(0x2891, "self_destruct_countdown")
mylabel(0x2892, "escape_capsule_on_screen")
mylabel(0x2893, "escape_capsule_x_fraction")
mylabel(0x2894, "escape_capsule_x_pixels")
mylabel(0x2895, "escape_capsule_y_fraction")
mylabel(0x2896, "escape_capsule_y_pixels")
mylabel(0x2897, "escape_capsule_launch_direction")
mylabel(0x2898, "unused")
mylabel(0x28a0, "initialise_game_screen")
mylabel(0x28d4, "unused")
mylabel(0x28d7, "launch_escape_capsule_port")
mylabel(0x28db, "launch_escape_capsule_starboard")
mylabel(0x28dd, "launch_escape_capsule")
mylabel(0x28f8, "handle_starship_self_destruct")
mylabel(0x290c, "skip_immense_damage")
mylabel(0x2914, "update_escape_capsule")
mylabel(0x294a, "skip_inversion")
mylabel(0x2958, "skip_inversion")
mylabel(0x2964, "return")
mylabel(0x2965, "escape_capsule_collided_with_enemy_ship")
mylabel(0x2983, "enemy_ship_is_already_exploding")
mylabel(0x2991, "mark_escape_capsule_as_off_screen")
mylabel(0x2997, "unused")
mylabel(0x2998, "plot_escape_capsule")
mylabel(0x29c0, "unused")
mylabel(0x29d4, "fire_enemy_torpedo_cluster")
mylabel(0x2a13, "add_single_torpedo_to_enemy_torpedo_cluster")
mylabel(0x2a38, "find_free_torpedo_slot")
mylabel(0x2a48, "skip")
mylabel(0x2a4d, "dont_add_any_more_torpedoes_to_cluster")
mylabel(0x2a51, "unused")
mylabel(0x2a56, "angle_to_action_table")
mylabel(0x2a5e, "unused")
mylabel(0x2a5f, "enemy_ship_behaviour_routine_low_table")
mylabel(0x2a60, "unused")
mylabel(0x2a70, "enemy_ship_behaviour_routine_high_table")

routine_index = 0
routine_dict = {}
for i in range(0, 16):
    code_ptr(0x2a5f + i, 0x2a70 + i, 0)
    addr = memory[0x2a5f + i] + 256 * memory[0x2a70 + i]
    if addr in routine_dict:
        formatted_comment(addr, line_break)
        entry(addr, "enemy_ship_behaviour_routine" + str(routine_dict[addr]))
    else:
        routine_dict[addr] = routine_index
        routine_index += 1

mylabel(0x2a80, "unused")
mylabel(0x2a81, "enemy_ship_desired_velocity")
mylabel(0x2a82, "partial_velocity_for_damaged_enemy_ships")
mylabel(0x2a83, "desired_velocity_for_intact_enemy_ships")
mylabel(0x2a84, "unused")
mylabel(0x2a8b, "enemy_ship_defensive_behaviour_handling")
mylabel(0x2ab2, "skip_retreating_because_of_damage")
mylabel(0x2acf, "already_retreating_because_of_angle")
mylabel(0x2adf, "skip_retreating_because_of_angle")
mylabel(0x2ae0, "set_temporary_behaviour_flags")
mylabel(0x2aef, "unset_retreating_flags")
mylabel(0x2af7, "leave_after_clearing_carry")
mylabel(0x2af9, "unused")
mylabel(0x2b01, "get_rectilinear_distance_from_centre_of_screen_accounting_for_starship_velocity")
mylabel(0x2b08, "skip_inversion")
mylabel(0x2b22, "skip_inversion")
mylabel(0x2b26, "get_rectilinear_distance_from_centre_of_screen")
mylabel(0x2b2d, "skip_inversion_x")
mylabel(0x2b36, "skip_inversion_y")
mylabel(0x2b3a, "unused")
mylabel(0x2b42, "turn_enemy_ship_towards_starship_using_pixels_or_screens_unused")
mylabel(0x2b47, "turn_enemy_ship_towards_starship_using_screens")
mylabel(0x2b54, "turn_enemy_ship_towards_starship_using_pixels_unused")
mylabel(0x2b5e, "turn_enemy_ship_towards_starship")
mylabel(0x2b61, "turn_enemy_ship_towards_desired_angle_accounting_for_starship_velocity")
mylabel(0x2b75, "skip_inversion")
mylabel(0x2b94, "loop_over_bits_of_sine")
mylabel(0x2b9b, "sine_bit_unset")
mylabel(0x2bb9, "finished_calculating_change_in_angle")
mylabel(0x2bc2, "skip_uninversion")
mylabel(0x2bcf, "turn_enemy_ship_towards_desired_angle")
mylabel(0x2bf3, "skip_velocity_decrease")
mylabel(0x2c00, "increase_angle")
mylabel(0x2c06, "continue")
mylabel(0x2c10, "no_change_needed_to_enemy_ship_angle")
mylabel(0x2c11, "unused")
mylabel(0x2c19, "unused_routine_to_turn_enemy_ship_on_screen_towards_starship")
mylabel(0x2c29, "decrease_enemy_ship_velocity")
mylabel(0x2c34, "return")
mylabel(0x2c35, "unused")
mylabel(0x2c3a, "increase_or_decrease_enemy_ship_velocity_towards_desired_velocity")
mylabel(0x2c4a, "increase")
mylabel(0x2c4d, "compare_velocity")
mylabel(0x2c50, "return")
mylabel(0x2c51, "unused")
mylabel(0x2c60, "starship_sprite_1")
mylabel(0x2c80, "starship_sprite_2")
mylabel(0x2ca0, "starship_sprite_3")
mylabel(0x2cc0, "starship_sprite_4")
mylabel(0x2ce0, "starship_sprite_5")
mylabel(0x2d00, "starship_sprite_6")
mylabel(0x2d20, "starship_sprite_7")
mylabel(0x2d40, "starship_sprite_8")
mylabel(0x2d60, "unused")
mylabel(0x2d61, "velocity_gauge_position")
mylabel(0x2d62, "rotation_gauge_position")
mylabel(0x2d63, "score_delta_low")
mylabel(0x2d64, "score_delta_high")
mylabel(0x2d65, "score_as_bcd")
mylabel(0x2d68, "unused")
mylabel(0x2d6e, "score_as_digits")
mylabel(0x2d74, "unused")
mylabel(0x2d75, "scores_for_destroying_enemy_ships")
mylabel(0x2d7f, "unused")
mylabel(0x2d86, "score_points_for_destroying_enemy_ship")
mylabel(0x2da2, "not_cloaked")
mylabel(0x2db2, "convert_offset_to_score")
mylabel(0x2dc9, "unused")
mylabel(0x2dd0, "apply_delta_to_score")
mylabel(0x2dfb, "zero_score_delate")
mylabel(0x2e01, "convert_score_as_bcd_to_score_as_digits")
mylabel(0x2e4a, "plot_score_loop")
mylabel(0x2e53, "non_zero_digit")
mylabel(0x2e58, "leading_zero")
mylabel(0x2e5f, "unused")
mylabel(0x2e61, "plot_scanner_grid")
mylabel(0x2e6d, "plot_vertical_lines_outer_loop")
mylabel(0x2e75, "plot_vertical_lines_inner_loop")
mylabel(0x2e8d, "plot_horizontal_lines_outer_loop")
mylabel(0x2e95, "plot_horizontal_lines_inner_loop")
mylabel(0x2eac, "plot_gauge_edges")
mylabel(0x2f39, "unused")
mylabel(0x2f45, "plot_starship_velocity_and_rotation_on_gauges")
mylabel(0x2f76, "plot_velocity_gauge_unset_loop")
mylabel(0x2f8e, "plot_velocity_gauge_set_loop")
mylabel(0x2f9e, "skip_velocity_gauge")
mylabel(0x2fc7, "set_rotation_gauge_position_for_unset")
mylabel(0x2fd6, "plot_rotation_gauge_unset_loop")
mylabel(0x2ff5, "set_rotation_gauge_position_for_set")
mylabel(0x2ffa, "plot_rotation_gauge_set_loop")
mylabel(0x300a, "skip_rotation_gauge")
mylabel(0x300d, "unused")
mylabel(0x3019, "plot_enemy_ships_on_scanners")
mylabel(0x3023, "plot_enemy_ships_on_scanners_loop")
mylabel(0x30a5, "skip_unplotting_enemy_ship_on_scanner")
mylabel(0x30b1, "to_skip_plotting_enemy_ship_on_scanner")
mylabel(0x30b4, "continue")
mylabel(0x3134, "skip_plotting_enemy_ship_on_scanner")
mylabel(0x3142, "continue")
mylabel(0x314f, "unused")
mylabel(0x3161, "handle_scanner_failure")
mylabel(0x316d, "starship_incurred_major_damage")
mylabel(0x317c, "turn_scanner_to_static")
mylabel(0x318c, "skip_unplotting_scanners")
mylabel(0x31a7, "plot_static_row_loop")
mylabel(0x31a9, "plot_static_column_loop")
mylabel(0x31cd, "return")
mylabel(0x31ce, "starship_didnt_incur_major_damage")
mylabel(0x31d3, "handle_failed_scanner")
mylabel(0x31e2, "update_static_row_loop")
mylabel(0x31e4, "update_static_column_loop")
mylabel(0x3204, "return")
mylabel(0x3205, "clear_long_range_scanner")
mylabel(0x320f, "clear_long_range_scanner_row_loop")
mylabel(0x3213, "clear_long_range_scanner_column_loop")
mylabel(0x3239, "unused")

mylabel(0x3266, "skip_setting_enemy_ship_was_on_screen_above")
mylabel(0x327e, "not_on_screen")
mylabel(0x3292, "not_on_screen_above")
mylabel(0x32ae, "to_return_from_enemy_ship_behaviour_routine")
mylabel(0x32d7, "skip_setting_desired_velocity")
mylabel(0x32e2, "to_set_retreating_and_head_towards_desired_velocity_and_angle")
mylabel(0x32e5, "off_screen")
mylabel(0x32e8, "return_after_changing_velocity")
mylabel(0x330c, "to_set_retreating_and_head_towards_desired_velocity_and_angle")
mylabel(0x330f, "return_after_turning_enemy_ship_towards_desired_angle")
mylabel(0x3315, "off_screen")
mylabel(0x3318, "return_after_changing_velocity")
mylabel(0x331b, "to_return_from_enemy_ship_behaviour_routine")
mylabel(0x332b, "skip_firing")
mylabel(0x3338, "off_screen")
mylabel(0x333e, "to_return_from_enemy_ship_behaviour_routine")
mylabel(0x3353, "decelerate")
mylabel(0x3356, "skip_deceleration")
mylabel(0x3361, "off_screen")
mylabel(0x3364, "return_after_changing_velocity")
mylabel(0x3381, "to_set_retreating_and_head_towards_desired_velocity_and_angle")
mylabel(0x3384, "off_screen")
mylabel(0x3387, "return_after_changing_velocity")

mylabel(0x338d, "set_retreating_and_head_towards_desired_velocity_and_angle")
mylabel(0x339e, "unused")
mylabel(0x33b1, "maximum_enemy_torpedo_cooldown_per_command")
mylabel(0x33b9, "command_number_used_for_maximum_enemy_torpedo_cooldown_lookup")
mylabel(0x33ba, "probability_of_new_enemy_ship_being_defensive_about_damage")
mylabel(0x33bb, "probability_of_new_enemy_ship_being_defensive_about_angle")
mylabel(0x33bc, "probability_of_new_enemy_ship_firing_torpedo_clusters")
mylabel(0x33bd, "probability_of_new_enemy_ship_being_large")
mylabel(0x33be, "unused")
mylabel(0x33c0, "change_in_enemy_ship_spawning_probabilities_per_command")
mylabel(0x33c4, "unused")
mylabel(0x33c6, "ultimate_enemy_ship_probabilities")
mylabel(0x33ca, "unused")
mylabel(0x33cc, "initial_enemy_ship_spawning_probabilities")
mylabel(0x33d0, "unused")
mylabel_with_comment(0x33d2, "initialise_enemy_ship")
mylabel(0x33f6, "skip")
mylabel(0x340c, "skip_swap")
mylabel(0x3438, "not_defensive_about_damage")
mylabel(0x3448, "defensive_about_angle")
mylabel(0x345b, "clusters_unset")
mylabel(0x3466, "small_ship")
mylabel(0x3476, "skip_ceiling")
mylabel(0x347f, "calculate_cooldown_loop")
mylabel(0x3487, "skip_addition")
mylabel(0x349e, "unused")
mylabel(0x34b0, "starship_type")
mylabel(0x34b1, "command_number")
mylabel(0x34b2, "regeneration_rate_for_enemy_ships")
mylabel(0x34b3, "maximum_timer_for_enemy_ships_regeneration")
mylabel(0x34b4, "timer_for_enemy_ships_regeneration")
mylabel(0x34b5, "base_regeneration_rate_for_starship")
mylabel(0x34b6, "maximum_timer_for_starship_energy_regeneration")
mylabel(0x34b7, "timer_for_starship_energy_regeneration")
mylabel(0x34b8, "base_damage_to_enemy_ship_from_other_collision")
mylabel(0x34b9, "maximum_number_of_stars_in_game")
mylabel(0x34ba, "minimum_number_of_stars")
mylabel(0x34bb, "change_in_number_of_stars_per_command")
mylabel(0x34bc, "subtraction_from_starship_regeneration_when_shields_active")
mylabel(0x34bd, "unused")
mylabel(0x34c0, "escape_capsule_launched_string")
mylabel(0x34de, "command_move_string")
mylabel(0x34e1, "command_move_string_horizontal_pos")
mylabel(0x34e4, "command_string")
mylabel(0x34f2, "unused")
mylabel(0x34f4, "prepare_starship_for_next_command")

mylabel(0x3578, "initialise_starship_sprite")
mylabel(0x3583, "initialise_starship_sprite_loop")
mylabel(0x359c, "unused")
mylabel(0x35a5, "plot_command_number")
mylabel(0x35b8, "plot_command_loop")
mylabel(0x35cf, "single_digit_command_number_for_move")
mylabel(0x35d4, "plot_command_move_loop")
mylabel(0x35e6, "single_digit_command_number")
mylabel(0x35f7, "plot_escape_capsule_launched")
mylabel(0x35f9, "plot_escape_capsule_launched_loop_loop")
mylabel(0x3614, "initialise_enemy_ships")
mylabel(0x361c, "initialise_enemy_ships_loop")
mylabel(0x362f, "initialise_joystick_and_cursor_keys")
mylabel(0x3641, "unused")
mylabel(0x364f, "update_enemy_ships")
mylabel(0x365a, "skip_timer_reset")
mylabel(0x3672, "update_enemy_ships_loop")
mylabel(0x367f, "to_skip_changing_behaviour_type")
mylabel(0x3682, "starship_still_viable")
mylabel(0x368b, "enemy_ship_is_damaged")
mylabel(0x3693, "set_velocity")
mylabel(0x36a0, "cooldown_is_zero")
mylabel(0x36b7, "skip_ceiling")
mylabel(0x36ba, "skip_enemy_regeneration")
mylabel(0x36d2, "return_from_enemy_ship_behaviour_routine")
mylabel(0x36d9, "skip_inversion_x")
mylabel(0x36e2, "skip_inversion_y")
mylabel(0x36f6, "skip_ceiling")
mylabel(0x36f9, "skip_behaviour_routine")
mylabel(0x3718, "skip_changing_behaviour_type")
mylabel(0x371d, "skip_resetting_hit_count")
mylabel(0x372d, "return")
mylabel(0x373b, "skip_firing")
mylabel(0x374b, "slow_to_a_crawl")
mylabel(0x374d, "use_speed_based_on_y_pixels")
mylabel(0x3758, "off_screen")
mylabel(0x375b, "return_after_changing_velocity")
mylabel(0x378a, "skip_setting_kamikaze_stage_one")
mylabel(0x379d, "decelerate")
mylabel(0x37a3, "skip_deceleration")
mylabel(0x37ae, "kamikaze_stage_one_set")
mylabel(0x37d7, "off_screen")
mylabel(0x37da, "return_after_changing_velocity")
mylabel(0x37dd, "to_return_from_enemy_ship_behaviour_routine")
mylabel(0x37e0, "unused")
mylabel(0x37f3, "start_game_continuation")
mylabel(0x3811, "reset_enemy_ship_spawning_probabilities_loop")
mylabel(0x3820, "unused")
mylabel(0x3833, "main_game_loop")
mylabel(0x3865, "skip_scanner_update")
mylabel(0x388b, "delay_loop_loop")
mylabel(0x3893, "skip_delay")
mylabel(0x38b0, "set_regeneration")
mylabel(0x38be, "starship_hasnt_exploded")
mylabel(0x38c4, "skip_player_movement")
mylabel(0x3907, "previous_score_as_bcd")
mylabel(0x38f9, "unused")
mylabel(0x3907, "previous_score_as_bcd")
expr_label(0x3908, "previous_score_as_bcd1 + 1")
expr_label(0x3909, "previous_score_as_bcd1 + 2")
mylabel(0x390a, "allowed_another_command")
mylabel(0x390b, "unused")
mylabel(0x3912, "combat_experience_rating_string")
mylabel(0x3997, "no_before_the_starship_exploded_string")
mylabel(0x39bd, "after_your_performance_string")
mylabel(0x3a1f, "and_returned_safely_text")
mylabel(0x3a4e, "but_collided_string")
mylabel(0x3a72, "having_just_gained_string")
mylabel(0x3a8c, "and_but_they_allow_string")
mylabel(0x3ac6, "emotions")
mylabel(0x3b1b, "and_they_retire_you_string")
expr_label(0x3b46, "threshold_table - 1")
mylabel(0x3b47, "threshold_table")
mylabel(0x3b4e, "unused")
mylabel(0x3b61, "plot_debriefing")
mylabel(0x3b68, "plot_row_of_starships_top_line_loop")
mylabel(0x3b81, "plot_row_of_starships_bottom_line_loop")
mylabel(0x3b98, "plot_combat_experience_rating_text_loop")
mylabel(0x3ba3, "plot_command_number")
mylabel(0x3bb9, "single_digit_command_number")
mylabel(0x3bce, "plot_no_before_the_starship_exploded_loop")
mylabel(0x3bdb, "escape_capsule_was_launched")
mylabel(0x3be2, "plot_and_returned_safely_loop")
mylabel(0x3bef, "escape_capsule_was_destroyed")
mylabel(0x3bf1, "plot_but_collided_loop")
mylabel(0x3bfc, "plot_score_in_debriefing")
mylabel(0x3c07, "plot_score_in_debriefing_loop")
mylabel(0x3c13, "non_zero_digit")
mylabel(0x3c15, "leading_zero")
mylabel(0x3c50, "plot_having_just_gained_loop")
mylabel(0x3c77, "skip_previous_command_score")
mylabel(0x3c7f, "plot_after_your_performance")
mylabel(0x3c81, "plot_after_your_performance_loop")
mylabel(0x3c8c, "judge_player")
mylabel(0x3c9f, "division_loop")
mylabel(0x3cb2, "check_threshold_loop")
mylabel(0x3cbc, "end_of_calculation")
mylabel(0x3cc2, "find_emotion_loop")
mylabel(0x3ccb, "plot_emotion_loop")
mylabel(0x3ced, "plot_and_or_but_loop")
mylabel(0x3cfa, "plot_they_allow_you_loop")
mylabel(0x3d07, "player_retired")
mylabel(0x3d0c, "plot_and_they_retire_you_loop")
mylabel(0x3d17, "leave_after_plotting_line_of_underscores")
mylabel(0x3d1b, "plot_line_of_underscores")
mylabel(0x3d27, "plot_line_of_underscores_loop")
mylabel(0x3d30, "tab_to_x_y")
mylabel(0x3d3e, "plot_bcd_number_as_two_digits")
mylabel(0x3d48, "has_non_zero_tens")
mylabel(0x3d50, "skip_leading_zeroes")
mylabel(0x3d58, "has_non_zero_ones")
mylabel(0x3d60, "skip_leading_zeroes_again")
mylabel(0x3d61, "unused")
mylabel(0x3d92, "instructions_string")
mylabel(0x3fd2, "unused")
mylabel(0x4016, "plot_instructions")
mylabel(0x4020, "plot_instructions_loop")
mylabel(0x4031, "finished_plotting_instructions")
mylabel(0x4041, "unused")
mylabel(0x404c, "plot_line_of_underscores_at_y")
mylabel(0x405f, "plot_line_of_underscores_at_y_loop")
mylabel(0x4066, "combat_preparation_screen_key_table")
expr_label(0x406f, "game_options - 1")
mylabel(0x4070, "game_options")
mylabel(0x4070, "option_sound")
mylabel(0x4071, "option_starship_torpedoes")
mylabel(0x4072, "option_enemy_torpedoes")
mylabel(0x4073, "option_keyboard_joystick")
expr_label(0x4072, "options_values_to_write - 2")
mylabel(0x4074, "options_values_to_write")
expr_label(0x407b, "option_address_low_table - 1")
mylabel(0x407c, "option_address_low_table")
expr_label(0x407f, "option_address_high_table - 1")
mylabel(0x4080, "option_address_high_table")
expr(0x407c, "<sound_enabled")
expr(0x407d, "<starship_torpedo_type")
expr(0x407e, "<enemy_torpedo_type_instruction")
expr(0x407f, "<keyboard_or_joystick")
expr(0x4080, ">sound_enabled")
expr(0x4081, ">starship_torpedo_type")
expr(0x4082, ">enemy_torpedo_type_instruction")
expr(0x4083, ">keyboard_or_joystick")
mylabel(0x4084, "combat_preparation_string")
mylabel(0x4197, "unused")
mylabel(0x419b, "plot_selected_options")
mylabel(0x419d, "plot_selected_options_loop")
mylabel(0x41bb, "wait_for_return")
mylabel(0x41c4, "wait_for_return_loop")
mylabel(0x41de, "bad_program")
mylabel(0x41e0, "unused")
mylabel(0x41e1, "escape_pressed")
mylabel(0x41e9, "instructions_screen")
mylabel(0x4203, "combat_preparation_screen")
mylabel(0x421d, "plot_combat_preparations_loop")
mylabel(0x422e, "finished_plotting_combat_preparations")
mylabel(0x423e, "get_keypress")
mylabel(0x425b, "check_next_key")
mylabel(0x4278, "not_f0")
mylabel(0x4282, "not_f1")
mylabel(0x42a4, "return")
mylabel_with_comment(0x42a5, "starfleet_records_string")
mylabel(0x4322, "unused")
expr_label(0x4325, "high_score_table - 16")
expr_label(0x4326, "high_score_table - 15")
expr_label(0x4327, "high_score_table - 14")
mylabel(0x4335, "high_score_table")
mylabel(0x43b5, "unused")
mylabel(0x43d7, "starfleet_records_screen")
mylabel(0x43ee, "plot_starfleet_records_loop")
mylabel(0x43ff, "finished_plotting_starfleet_records")
mylabel(0x4405, "plot_high_scores_loop")
mylabel(0x4439, "plot_name_loop")
mylabel(0x4466, "leave_after_plotting_underscores")
mylabel(0x4479, "plot_two_digit_high_score")
mylabel(0x4486, "plot_one_digit_high_score")
mylabel(0x448b, "not_zero")
mylabel(0x4490, "leading_zero")
mylabel(0x4503, "consider_records_loop")
mylabel(0x451f, "consider_next_record")
mylabel(0x4529, "higher_score")
mylabel(0x452d, "move_records_down_a_slot_loop")
mylabel(0x453b, "finished_moving_records")
mylabel(0x4545, "plot_enter_your_name_loop")
mylabel(0x4556, "finished_plotting_enter_your_name")
mylabel(0x4568, "escape_not_pressed")
mylabel(0x457e, "copy_name_loop")
mylabel(0x458c, "pad_name_loop")
mylabel(0x4599, "finished_padding_name")
mylabel(0x459d, "plot_shields_string_and_something")
mylabel(0x45ad, "return")
mylabel(0x45ae, "plot_auto_shields_string")
mylabel(0x45b8, "plot_shields_string")
mylabel(0x45ba, "plot_shields_string_loop")
mylabel(0x45c4, "return")
mylabel(0x45c5, "unused")
mylabel(0x45da, "start_game")
mylabel(0x45f8, "unused")
mylabel(0x4607, "end_of_command")
mylabel(0x4639, "start_next_command")
mylabel(0x4650, "change_probabilities_loop")
mylabel(0x465f, "skip_change_of_probability")
mylabel(0x4671, "skip_change_of_stars")
mylabel(0x47bf, "initialise_stars_loop")
mylabel(0x47f7, "plot_the_frontiers_loop")
mylabel(0x4808, "finished_the_frontiers")
mylabel(0x4839, "wait_for_return_in_frontiers")
mylabel(0x4854, "osbyte_then_wait_for_return")
mylabel(0x485a, "return_pressed")
mylabel(0x4871, "unused")
mylabel(0x4879, "unused_title_string")
mylabel(0x48b9, "unused")
mylabel(0x48ba, "unused_title_screen")
mylabel(0x48c6, "plot_title_loop")
mylabel(0x48d3, "finished_plotting_title")
mylabel(0x4900, "get_joystick_input")
mylabel(0x490f, "fire_not_pressed")
mylabel(0x492f, "skip_floor")
mylabel(0x4935, "increase_velocity")
mylabel(0x493b, "decrease_velocity")
mylabel(0x493e, "consider_rotation")
mylabel(0x4953, "skip_subtraction")
mylabel(0x495c, "rotate_anticlockwise")
mylabel(0x4962, "rotate_clockwise")
mylabel(0x4965, "return")
mylabel(0x4966, "unused")
mylabel(0x4970, "unused_copyright_string")
mylabel(0x49f0, "sound_10")
mylabel(0x49f2, "sound_10_volume_low")
mylabel(0x49f3, "sound_10_volume_high")
mylabel(0x49f4, "sound_10_pitch")
mylabel(0x49f8, "sound_11")
mylabel(0x4a00, "initial_star_positions")
mylabel(0x4b00, "star_table")
mylabel(0x4bd0, "starship_explosion_table")
mylabel(0x4c90, "further_star_table")
mylabel(0x4d00, "enemy_explosion_tables")
mylabel(0x4f00, "starship_torpedoes_table")
mylabel(0x4f6c, "unused")
mylabel(0x4fb4, "enemy_torpedoes_table")
mylabel(0x5044, "unused")
mylabel(0x593f, "unused_copy_of_scanner_static_eor")
mylabel(0x6b38, "starship_top_screen_address")
mylabel(0x6c78, "starship_bottom_screen_address")
mylabel(0x6e48, "energy_screen_address")
mylabel(0x0e00, "unused_copyright_string")

print("; " + line_break)
print(""";
; Starship Command (the original BBC Micro version)
;
; Disassembled by TobyLobster using the py8dis tool.
; Based on the labels from the Level 7 disassembly (http://www.level7.org.uk/miscellany/starship-command-disassembly.txt)
;""")
print("; " + line_break + "\n")

go()
